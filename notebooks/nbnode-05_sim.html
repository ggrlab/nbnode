<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Flow cytometry simulation. &#8212; nbnode 0.0.post1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=233b9934" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e37d3753"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contributing" href="../contributing.html" />
    <link rel="prev" title="Advanced predictions, data and plotting" href="nbnode-04.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Flow-cytometry-simulation.">
<h1>Flow cytometry simulation.<a class="headerlink" href="#Flow-cytometry-simulation." title="Permalink to this heading">¶</a></h1>
<p>Using <code class="docutils literal notranslate"><span class="pre">NBNode</span></code> as basis enables the simulation of (flow) cytometry data. Cytometry data consists of an unordered matrix of n <code class="docutils literal notranslate"><span class="pre">cells</span></code> and p <code class="docutils literal notranslate"><span class="pre">features</span></code>. The ordering of cells in the matrix does not hold any significant information, except in cases where data corruption has occurred during the experiment.</p>
<p>As an example, we previously utilized a cell matrix originating from the Beckman Coulter <code class="docutils literal notranslate"><span class="pre">DURAClone</span> <span class="pre">IM</span> <span class="pre">T</span> <span class="pre">Cell</span> <span class="pre">Subsets</span> <span class="pre">Antibody</span> <span class="pre">Panel</span></code>. This particular panel measures 10 markers in fluorochrome combinations that provide robust population identification, including CD3, CD4, CD8, CD27, CD28, CD45, CD45RA, CD57, CD197 (CCR7), CD279 (PD-1). Additionally, forward scatter and side scatter are usually measured, increasing the number of <code class="docutils literal notranslate"><span class="pre">features</span></code> per cell to 13.</p>
<p>According to their <code class="docutils literal notranslate"><span class="pre">feature</span></code> values, <code class="docutils literal notranslate"><span class="pre">cells</span></code> can be classified (“gated”) into cell types, e.g. <code class="docutils literal notranslate"><span class="pre">CD4+</span> <span class="pre">central</span> <span class="pre">memory</span> <span class="pre">T</span> <span class="pre">cells</span></code> or <code class="docutils literal notranslate"><span class="pre">CD27+</span> <span class="pre">CD28+</span> <span class="pre">CD4+</span> <span class="pre">T</span> <span class="pre">cells</span></code>. Within one cell type, <code class="docutils literal notranslate"><span class="pre">features</span></code> do still vary. In this package, we use <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code> for any defined set of cells.</p>
<p>Our class <code class="docutils literal notranslate"><span class="pre">FlowSimulationTree</span></code> uses an existing gating applied to multiple samples and simulates two major parts:</p>
<ol class="arabic simple">
<li><p>How many <code class="docutils literal notranslate"><span class="pre">cells</span></code> are of which <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code></p></li>
<li><p>How are cell <code class="docutils literal notranslate"><span class="pre">features</span></code> distributed <em>within</em> one <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code></p></li>
</ol>
<p>In this example, we will use data from 48 healthy human peripheral blood samples stained with the DURAClone IM T Cell Subsets Tube (Beckman Coulter GmbH). The data is available under <a class="reference external" href="https://doi.org/10.5281/zenodo.7883353">zenodo 7883353</a>.</p>
<section id="Synthetic-data-based-on-previous-samples">
<h2>Synthetic data based on previous samples<a class="headerlink" href="#Synthetic-data-based-on-previous-samples" title="Permalink to this heading">¶</a></h2>
<p>To enable the analysis also with data supplied with package, I supply the final result <code class="docutils literal notranslate"><span class="pre">flowsim_tree.pickle</span></code> which has done downloading gating and initiating the simulation.</p>
<p>First, download the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> false --no-raise-error

# This downloading takes about 1.5 minutes

# From https://github.com/zenodo/zenodo/issues/1888
import os

import requests

# params = {&quot;access_token&quot;: &quot;ZENODO_ACCESS_TOKEN&quot;}  # only necessary until public
params = {}

record_id = &quot;7883353&quot;

r = requests.get(
    f&quot;https://zenodo.org/api/records/{record_id}&quot;, params=params
)
print(r.json())
download_urls = [f[&quot;links&quot;][&quot;self&quot;] for f in r.json()[&quot;files&quot;]]
filenames = [f[&quot;key&quot;] for f in r.json()[&quot;files&quot;]]

print(r.status_code)
print(download_urls)

outdir = &quot;example_data/asinh.align_manual.CD3_Gate&quot;
os.makedirs(outdir, exist_ok=True)

for filename, url in zip(filenames, download_urls):
    print(&quot;Downloading:&quot;, filename)
    r = requests.get(url, params=params)
    with open(os.path.join(outdir, filename), &quot;wb&quot;) as f:
        f.write(r.content)
<br/></pre></div>
</div>
</div>
<p>The (pre-defined) tree for this dataset is <code class="docutils literal notranslate"><span class="pre">nbtree.tree_complete_aligned_v2()</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> false --no-raise-error

import nbnode.nbnode_trees as nbtree
complete_tree = nbtree.tree_complete_aligned_v2()
complete_tree.pretty_print()
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nbtree.tree_complete_aligned_v2</span></code> has specific ideas about the naming of the markers, so we need to use the same names here.</p>
<p><code class="docutils literal notranslate"><span class="pre">new_colnames</span></code> replaces the column names in all CSV files, regardless of how they were named before, so use with caution!</p>
<p><code class="docutils literal notranslate"><span class="pre">gate_csv()</span></code> now places all cells from all samples in the <code class="docutils literal notranslate"><span class="pre">NBNode</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> false --no-raise-error

# This gate_csv takes about a minute
from nbnode.apply.gate_csv import gate_csv
all_files = [
        os.path.join(outdir, file_x)
        for file_x in os.listdir(outdir)
    ]
new_colnames = [
        &quot;FS&quot;,
        &quot;FS.0&quot;,
        &quot;SS&quot;,
        &quot;CD45RA&quot;,
        &quot;CCR7&quot;,
        &quot;CD28&quot;,
        &quot;PD1&quot;,
        &quot;CD27&quot;,
        &quot;CD4&quot;,
        &quot;CD8&quot;,
        &quot;CD3&quot;,
        &quot;CD57&quot;,
        &quot;CD45&quot;,
    ]
celltree_gated = gate_csv(
        csv=all_files,
        celltree=complete_tree,
        new_colnames=new_colnames,
    )
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> false --no-raise-error

celltree_gated.pretty_print()
</pre></div>
</div>
</div>
<p>After we have the number of cells per node, we can generate a Dirichlet-based simulation. In particular, the number of cells per node are described by a single Dirichlet distribution containing a concentration parameter for every leaf node.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">script</span> false --no-raise-error

from nbnode.simulation.FlowSimulationTree import FlowSimulationTreeDirichlet

flowsim_tree = FlowSimulationTreeDirichlet(
    rootnode=celltree_gated,
    include_features=new_colnames,
)

from nbnode.io.pickle_open_dump import pickle_open_dump

pickle_open_dump(flowsim_tree, &quot;flowsim_tree.pickle&quot;)
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="s2">&quot;testdata&quot;</span><span class="p">,</span> <span class="s2">&quot;flowcytometry&quot;</span><span class="p">,</span> <span class="s2">&quot;flowsim_tree.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">flowsim_tree</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style type='text/css'>
.datatable table.frame { margin-bottom: 0; }
.datatable table.frame thead { border-bottom: none; }
.datatable table.frame tr.coltypes td {  color: #FFFFFF;  line-height: 6px;  padding: 0 0.5em;}
.datatable .bool    { background: #DDDD99; }
.datatable .object  { background: #565656; }
.datatable .int     { background: #5D9E5D; }
.datatable .float   { background: #4040CC; }
.datatable .str     { background: #CC4040; }
.datatable .time    { background: #40CC40; }
.datatable .row_index {  background: var(--jp-border-color3);  border-right: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  font-size: 9px;}
.datatable .frame tbody td { text-align: left; }
.datatable .frame tr.coltypes .row_index {  background: var(--jp-border-color0);}
.datatable th:nth-child(2) { padding-left: 12px; }
.datatable .hellipsis {  color: var(--jp-cell-editor-border-color);}
.datatable .vellipsis {  background: var(--jp-layout-color0);  color: var(--jp-cell-editor-border-color);}
.datatable .na {  color: var(--jp-cell-editor-border-color);  font-size: 80%;}
.datatable .sp {  opacity: 0.25;}
.datatable .footer { font-size: 9px; }
.datatable .frame_dimensions {  background: var(--jp-border-color3);  border-top: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  display: inline-block;  opacity: 0.6;  padding: 1px 10px 1px 5px;}
</style></div>
</div>
<p>That’s it. We can now simulate synthetic flow cytometry samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FS</th>
      <th>FS.0</th>
      <th>SS</th>
      <th>CD45RA</th>
      <th>CCR7</th>
      <th>CD28</th>
      <th>PD1</th>
      <th>CD27</th>
      <th>CD4</th>
      <th>CD8</th>
      <th>CD3</th>
      <th>CD57</th>
      <th>CD45</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.100577</td>
      <td>5.251694</td>
      <td>-0.287347</td>
      <td>0.065961</td>
      <td>0.659882</td>
      <td>0.955657</td>
      <td>1.205756</td>
      <td>0.564757</td>
      <td>0.998757</td>
      <td>0.028991</td>
      <td>0.049317</td>
      <td>0.044155</td>
      <td>-0.168126</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.092387</td>
      <td>5.286552</td>
      <td>-0.061012</td>
      <td>0.007936</td>
      <td>0.567971</td>
      <td>1.060524</td>
      <td>0.914231</td>
      <td>0.944080</td>
      <td>1.109905</td>
      <td>-0.007508</td>
      <td>-0.070442</td>
      <td>0.025814</td>
      <td>0.349142</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.159748</td>
      <td>5.295267</td>
      <td>-0.008783</td>
      <td>-0.022918</td>
      <td>0.773974</td>
      <td>1.353215</td>
      <td>0.590003</td>
      <td>0.732128</td>
      <td>1.040836</td>
      <td>0.065331</td>
      <td>-0.086695</td>
      <td>-0.058003</td>
      <td>0.352973</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.036379</td>
      <td>5.286429</td>
      <td>-0.355162</td>
      <td>0.022301</td>
      <td>0.555761</td>
      <td>1.093256</td>
      <td>1.016961</td>
      <td>0.729056</td>
      <td>0.925360</td>
      <td>0.085008</td>
      <td>0.100495</td>
      <td>-0.051198</td>
      <td>-0.029892</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.211879</td>
      <td>5.305992</td>
      <td>-0.224904</td>
      <td>-0.010840</td>
      <td>0.883872</td>
      <td>1.357975</td>
      <td>1.194074</td>
      <td>1.329266</td>
      <td>0.886225</td>
      <td>0.041453</td>
      <td>-0.734879</td>
      <td>0.003398</td>
      <td>0.009937</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.037094</td>
      <td>5.235038</td>
      <td>-0.212276</td>
      <td>0.514944</td>
      <td>0.924698</td>
      <td>0.973519</td>
      <td>0.950437</td>
      <td>0.984918</td>
      <td>1.038688</td>
      <td>0.063404</td>
      <td>-0.441071</td>
      <td>-0.025791</td>
      <td>-0.398935</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.236324</td>
      <td>5.226253</td>
      <td>-0.254201</td>
      <td>0.772118</td>
      <td>1.087614</td>
      <td>0.953043</td>
      <td>0.559132</td>
      <td>1.006041</td>
      <td>0.903030</td>
      <td>0.079715</td>
      <td>0.196283</td>
      <td>-0.033585</td>
      <td>-0.073690</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.044698</td>
      <td>5.232621</td>
      <td>-0.174454</td>
      <td>0.569029</td>
      <td>1.018878</td>
      <td>0.909895</td>
      <td>0.714083</td>
      <td>1.076313</td>
      <td>1.044681</td>
      <td>0.078261</td>
      <td>0.222197</td>
      <td>-0.030222</td>
      <td>0.158465</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.274186</td>
      <td>5.271703</td>
      <td>0.091757</td>
      <td>0.426830</td>
      <td>-0.053408</td>
      <td>-0.130320</td>
      <td>0.889216</td>
      <td>-0.187032</td>
      <td>0.013959</td>
      <td>1.186677</td>
      <td>-0.058428</td>
      <td>0.947983</td>
      <td>-0.061106</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.368384</td>
      <td>5.290500</td>
      <td>-0.148017</td>
      <td>-0.016317</td>
      <td>-0.096373</td>
      <td>0.959208</td>
      <td>0.616525</td>
      <td>0.484474</td>
      <td>0.039499</td>
      <td>-0.003198</td>
      <td>0.573195</td>
      <td>0.695084</td>
      <td>-0.030929</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">synthetic_sample</span><span class="p">,</span> <span class="n">cell_numbers</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">return_sampled_cell_numbers</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of cells per population in the synthetic sample</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cell_numbers</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">Synthetic sample&quot;</span><span class="p">)</span>
<span class="n">synthetic_sample</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of cells per population in the synthetic sample

/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+        0.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-        0.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-           298.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+        0.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-             0.0
                                                    ...
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+      0.0
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-      0.0
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-           0.0
/AllCells/DN                                         84.0
/AllCells/DP                                          0.0
Name: 0, Length: 96, dtype: float64



Synthetic sample
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FS</th>
      <th>FS.0</th>
      <th>SS</th>
      <th>CD45RA</th>
      <th>CCR7</th>
      <th>CD28</th>
      <th>PD1</th>
      <th>CD27</th>
      <th>CD4</th>
      <th>CD8</th>
      <th>CD3</th>
      <th>CD57</th>
      <th>CD45</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.199053</td>
      <td>5.234598</td>
      <td>-0.088241</td>
      <td>-0.034998</td>
      <td>0.924329</td>
      <td>1.131150</td>
      <td>1.082737</td>
      <td>0.809666</td>
      <td>1.125293</td>
      <td>0.004234</td>
      <td>0.046163</td>
      <td>-0.045944</td>
      <td>0.179582</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.008096</td>
      <td>5.277367</td>
      <td>0.184243</td>
      <td>0.056715</td>
      <td>0.681012</td>
      <td>0.935260</td>
      <td>0.782681</td>
      <td>1.024696</td>
      <td>1.124938</td>
      <td>-0.051580</td>
      <td>-0.774571</td>
      <td>-0.036563</td>
      <td>0.035795</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.031465</td>
      <td>5.147636</td>
      <td>0.214739</td>
      <td>0.009059</td>
      <td>0.498950</td>
      <td>1.033221</td>
      <td>0.657734</td>
      <td>0.879537</td>
      <td>0.999712</td>
      <td>0.055606</td>
      <td>-0.289094</td>
      <td>-0.055068</td>
      <td>0.119610</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.205881</td>
      <td>5.244811</td>
      <td>-0.124324</td>
      <td>-0.077907</td>
      <td>0.594776</td>
      <td>1.187281</td>
      <td>0.837427</td>
      <td>0.892707</td>
      <td>0.987820</td>
      <td>0.037409</td>
      <td>0.041813</td>
      <td>-0.041016</td>
      <td>-0.032496</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.009315</td>
      <td>5.210594</td>
      <td>-0.185055</td>
      <td>0.002598</td>
      <td>0.657654</td>
      <td>1.181162</td>
      <td>0.950851</td>
      <td>1.259253</td>
      <td>1.112355</td>
      <td>0.025556</td>
      <td>-0.008730</td>
      <td>-0.000847</td>
      <td>-0.078750</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>995</th>
      <td>-0.159198</td>
      <td>5.304853</td>
      <td>0.272190</td>
      <td>-0.230301</td>
      <td>0.271408</td>
      <td>0.809975</td>
      <td>0.973990</td>
      <td>0.149426</td>
      <td>-0.036235</td>
      <td>-0.036501</td>
      <td>0.595494</td>
      <td>0.777754</td>
      <td>-0.411414</td>
    </tr>
    <tr>
      <th>996</th>
      <td>-0.209859</td>
      <td>5.266154</td>
      <td>0.135413</td>
      <td>0.382660</td>
      <td>0.265313</td>
      <td>1.075741</td>
      <td>1.255181</td>
      <td>0.844357</td>
      <td>-0.004307</td>
      <td>-0.002984</td>
      <td>-0.164177</td>
      <td>-0.372914</td>
      <td>-0.011075</td>
    </tr>
    <tr>
      <th>997</th>
      <td>-0.077003</td>
      <td>5.277108</td>
      <td>0.339912</td>
      <td>0.050631</td>
      <td>0.568426</td>
      <td>0.513111</td>
      <td>0.259577</td>
      <td>0.814484</td>
      <td>0.058262</td>
      <td>-0.021971</td>
      <td>0.919959</td>
      <td>0.512811</td>
      <td>-0.023790</td>
    </tr>
    <tr>
      <th>998</th>
      <td>0.015126</td>
      <td>5.278076</td>
      <td>0.214904</td>
      <td>0.111095</td>
      <td>0.130813</td>
      <td>0.388185</td>
      <td>0.078628</td>
      <td>0.316861</td>
      <td>-0.033330</td>
      <td>0.009760</td>
      <td>0.600114</td>
      <td>0.737948</td>
      <td>0.521447</td>
    </tr>
    <tr>
      <th>999</th>
      <td>0.144214</td>
      <td>5.218433</td>
      <td>0.261650</td>
      <td>0.407119</td>
      <td>0.179927</td>
      <td>0.320780</td>
      <td>0.522724</td>
      <td>0.805193</td>
      <td>0.035672</td>
      <td>0.024522</td>
      <td>0.070480</td>
      <td>-0.048929</td>
      <td>-0.143095</td>
    </tr>
  </tbody>
</table>
<p>1000 rows × 13 columns</p>
</div></div>
</div>
<p>If you do not need the actual cell <code class="docutils literal notranslate"><span class="pre">features</span></code> but only the number of cells per <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code>, you can do that with <code class="docutils literal notranslate"><span class="pre">sample_populations()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cell_numbers</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample_populations</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">cell_numbers</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+       11.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-        3.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-           305.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+        3.0
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-             0.0
                                                    ...
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+      0.0
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-      0.0
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-           0.0
/AllCells/DN                                         68.0
/AllCells/DP                                         12.0
Name: 0, Length: 96, dtype: float64
</pre></div></div>
</div>
<p>Internally:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sample_populations()</span></code> is called to generate the number of cells per leaf</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multivariate_normal()</span></code> generates the cell <code class="docutils literal notranslate"><span class="pre">features</span></code> for each cell</p></li>
</ol>
<p>You can also set a seed for reproducibility.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">synthetic_sample</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">synthetic_sample</span><span class="p">)</span>

<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">synthetic_sample</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">synthetic_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
         FS      FS.0        SS    CD45RA      CCR7      CD28       PD1
0  0.033016  5.212589  0.027994 -0.042323  1.068687  1.230491  0.727421  \
1 -0.034233  5.219806  0.041332  0.009111  0.016646  1.218523  0.445606
2  0.395116  5.366544  0.085398  0.737223  0.762656  0.641986  1.200716

       CD27       CD4       CD8       CD3      CD57      CD45
0  0.667649  1.017606 -0.012887 -0.232470 -0.015077  0.049724
1  0.971163  1.167465  0.033722  0.081410  0.019712 -0.191248
2  1.028306 -0.014907  0.892293 -0.686076 -0.011778  0.000069
         FS      FS.0        SS    CD45RA      CCR7      CD28       PD1
0  0.033016  5.212589  0.027994 -0.042323  1.068687  1.230491  0.727421  \
1 -0.034233  5.219806  0.041332  0.009111  0.016646  1.218523  0.445606
2  0.395116  5.366544  0.085398  0.737223  0.762656  0.641986  1.200716

       CD27       CD4       CD8       CD3      CD57      CD45
0  0.667649  1.017606 -0.012887 -0.232470 -0.015077  0.049724
1  0.971163  1.167465  0.033722  0.081410  0.019712 -0.191248
2  1.028306 -0.014907  0.892293 -0.686076 -0.011778  0.000069
</pre></div></div>
</div>
<p>Per default, the normal distribution is based on a diagonal covariance matrix estimated on the cells per leaf node. However, you can enable the full covariance matrix!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="c1"># default</span>
<span class="n">synthetic_sample</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">use_only_diagonal_covmat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">synthetic_sample</span><span class="p">)</span>

<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">synthetic_sample</span> <span class="o">=</span> <span class="n">flowsim_tree</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_cells</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">use_only_diagonal_covmat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">synthetic_sample</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
         FS      FS.0        SS    CD45RA      CCR7      CD28       PD1
0  0.033016  5.212589  0.027994 -0.042323  1.068687  1.230491  0.727421  \
1 -0.034233  5.219806  0.041332  0.009111  0.016646  1.218523  0.445606
2  0.395116  5.366544  0.085398  0.737223  0.762656  0.641986  1.200716

       CD27       CD4       CD8       CD3      CD57      CD45
0  0.667649  1.017606 -0.012887 -0.232470 -0.015077  0.049724
1  0.971163  1.167465  0.033722  0.081410  0.019712 -0.191248
2  1.028306 -0.014907  0.892293 -0.686076 -0.011778  0.000069
         FS      FS.0        SS    CD45RA      CCR7      CD28       PD1
0 -0.014040  5.287691  0.113469 -0.056042  0.963664  1.316469  0.788263  \
1  0.077410  5.221344  0.198341 -0.028692  0.049742  1.251280  0.402444
2 -0.093948  5.399214  0.514198  1.252213  1.269626  0.644032  0.538064

       CD27       CD4       CD8       CD3      CD57      CD45
0  1.189001  1.073660  0.097426 -0.041899  0.009045 -0.067505
1  0.653476  0.899301  0.023174 -0.265431  0.006454 -0.508050
2  1.183130  0.016804  1.130555 -0.224201  0.028751  0.131174
</pre></div></div>
</div>
</section>
<section id="Synthetic-data-with-effects">
<h2>Synthetic data with effects<a class="headerlink" href="#Synthetic-data-with-effects" title="Permalink to this heading">¶</a></h2>
<p>Previously, our ability was limited to mimicing the original dataset. However, we can also introduce effects in any <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code>! This means we can modify the proportion of cells derived from a particular <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code> in a synthesized sample. Specifically, we defined the proportion of cells in a population using a Dirichlet distribution and its corresponding concentration parameters. By altering these parameters, we can adjust the number of cells in the population.</p>
<p>Note that we are not changing how the cells are samples <em>within</em> a leaf node!</p>
<p>We show two ways to simulate different effects:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TreeMeanRelative()</span></code>: Change any <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code> by a relative amount.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TreeMeanDistributionSampler()</span></code>: Force any distribution on a single <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code></p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">TreeMeanRelative</span></code> changes the concentration of a <code class="docutils literal notranslate"><span class="pre">cell</span> <span class="pre">population</span></code> by a certain factor (e.g. old = 173.2, new = old*2) and all other concentration parameters decrease (by a factor) such that the overall sum of concentration parameters remains equal.</p>
<p><code class="docutils literal notranslate"><span class="pre">TreeMeanDistributionSampler()</span></code> first samples a <em>target</em> proportion from a given distribution and then sets the concentration parameter such that on average the cell population contains this proportion. Again, the sum of concentration parameters remains equal.</p>
<section id="TreeMeanRelative">
<h3><code class="docutils literal notranslate"><span class="pre">TreeMeanRelative</span></code><a class="headerlink" href="#TreeMeanRelative" title="Permalink to this heading">¶</a></h3>
<p>The following sets up a <code class="docutils literal notranslate"><span class="pre">TreeMeanRelative</span></code> where the cell population <code class="docutils literal notranslate"><span class="pre">/AllCells/DN</span></code> is changed by the factor 1 (therefore remains equal). <code class="docutils literal notranslate"><span class="pre">n_samples</span></code> is set to 2 and <code class="docutils literal notranslate"><span class="pre">n_cells</span></code> to 100.</p>
<p>Therefore, calling <code class="docutils literal notranslate"><span class="pre">tmr.sample()</span></code> generates two samples with the original distribution, 100 cells each. <code class="docutils literal notranslate"><span class="pre">tmr.sample()</span></code> returns the number of cells per leaf population for both samples, the parameters after changing (the original tree is not changed) and the actually sampled samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbnode.simulation.TreeMeanRelative</span> <span class="kn">import</span> <span class="n">TreeMeanRelative</span>
<span class="n">tmr</span> <span class="o">=</span> <span class="n">TreeMeanRelative</span><span class="p">(</span>
    <span class="n">flowsim_tree</span><span class="p">,</span>
    <span class="n">change_pop_mean_proportional</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_cells</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tmr</span><span class="p">)</span>
<span class="n">true_popcounts</span><span class="p">,</span> <span class="n">changed_parameters</span><span class="p">,</span> <span class="n">sampled_samples</span> <span class="o">=</span> <span class="n">tmr</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="n">true_popcounts</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;nbnode.simulation.TreeMeanRelative.TreeMeanRelative object at 0x7f937d9c8b50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample_0</th>
      <th>sample_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-</th>
      <td>31.0</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/DN</th>
      <td>6.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>/AllCells/DP</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 2 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">changed_parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>  <span class="c1"># these are the concentration parameters of the Dirichlet distribution</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+       0.901580
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-       0.295210
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-           48.203633
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+       0.091623
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-            0.096534
                                                      ...
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+     0.159252
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-     0.153660
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-          0.125163
/AllCells/DN                                        15.218566
/AllCells/DP                                         1.755718
Name: 0, Length: 96, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_samples</span><span class="p">)</span><span class="si">}</span><span class="s2"> synthetic samples, showing only the first</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">sampled_samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
There are 2 synthetic samples, showing only the first

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FS</th>
      <th>FS.0</th>
      <th>SS</th>
      <th>CD45RA</th>
      <th>CCR7</th>
      <th>CD28</th>
      <th>PD1</th>
      <th>CD27</th>
      <th>CD4</th>
      <th>CD8</th>
      <th>CD3</th>
      <th>CD57</th>
      <th>CD45</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.062235</td>
      <td>5.241828</td>
      <td>0.167840</td>
      <td>-0.084488</td>
      <td>0.462969</td>
      <td>1.327377</td>
      <td>1.020327</td>
      <td>0.735205</td>
      <td>0.919547</td>
      <td>-0.024936</td>
      <td>-0.459670</td>
      <td>-0.024190</td>
      <td>-0.155744</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.137097</td>
      <td>5.211038</td>
      <td>0.006071</td>
      <td>-0.013674</td>
      <td>0.631770</td>
      <td>1.354644</td>
      <td>0.924415</td>
      <td>1.071354</td>
      <td>0.909430</td>
      <td>-0.011694</td>
      <td>-0.594609</td>
      <td>-0.015247</td>
      <td>-0.368281</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.049543</td>
      <td>5.226160</td>
      <td>-0.092377</td>
      <td>0.032866</td>
      <td>0.720488</td>
      <td>1.218761</td>
      <td>0.788295</td>
      <td>1.015296</td>
      <td>1.006380</td>
      <td>0.065456</td>
      <td>-0.138280</td>
      <td>0.082154</td>
      <td>0.100491</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.161587</td>
      <td>5.303274</td>
      <td>-0.203429</td>
      <td>-0.063234</td>
      <td>0.272455</td>
      <td>1.249179</td>
      <td>0.712787</td>
      <td>1.112724</td>
      <td>1.045490</td>
      <td>0.031186</td>
      <td>-0.482921</td>
      <td>0.040894</td>
      <td>-0.401152</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.153456</td>
      <td>5.171440</td>
      <td>0.188800</td>
      <td>0.084201</td>
      <td>0.742456</td>
      <td>1.389247</td>
      <td>0.397038</td>
      <td>0.904283</td>
      <td>1.021047</td>
      <td>0.004681</td>
      <td>-0.283981</td>
      <td>-0.004825</td>
      <td>-0.402051</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>95</th>
      <td>0.315077</td>
      <td>5.217177</td>
      <td>0.494209</td>
      <td>-0.770656</td>
      <td>-0.407820</td>
      <td>0.650297</td>
      <td>1.125016</td>
      <td>0.144094</td>
      <td>-0.011654</td>
      <td>0.032542</td>
      <td>0.723826</td>
      <td>1.004760</td>
      <td>0.156519</td>
    </tr>
    <tr>
      <th>96</th>
      <td>0.534101</td>
      <td>5.270793</td>
      <td>0.460711</td>
      <td>0.347915</td>
      <td>0.157224</td>
      <td>0.784490</td>
      <td>1.131765</td>
      <td>0.869825</td>
      <td>0.019530</td>
      <td>-0.018556</td>
      <td>0.217103</td>
      <td>0.367984</td>
      <td>0.458230</td>
    </tr>
    <tr>
      <th>97</th>
      <td>-0.226989</td>
      <td>5.252685</td>
      <td>-0.189814</td>
      <td>0.154086</td>
      <td>-0.156006</td>
      <td>0.536826</td>
      <td>1.165235</td>
      <td>0.703251</td>
      <td>0.030829</td>
      <td>-0.052641</td>
      <td>0.138474</td>
      <td>0.634439</td>
      <td>0.154382</td>
    </tr>
    <tr>
      <th>98</th>
      <td>-0.001238</td>
      <td>5.322612</td>
      <td>0.424035</td>
      <td>0.193686</td>
      <td>0.277735</td>
      <td>1.124228</td>
      <td>0.598610</td>
      <td>0.624192</td>
      <td>0.010864</td>
      <td>-0.030898</td>
      <td>0.231010</td>
      <td>-0.259944</td>
      <td>0.003429</td>
    </tr>
    <tr>
      <th>99</th>
      <td>0.108700</td>
      <td>5.239704</td>
      <td>-0.103004</td>
      <td>0.554299</td>
      <td>0.218544</td>
      <td>0.567261</td>
      <td>0.524959</td>
      <td>0.422115</td>
      <td>-0.107181</td>
      <td>-0.006251</td>
      <td>0.420655</td>
      <td>0.294118</td>
      <td>-0.431249</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 13 columns</p>
</div></div>
</div>
<p>Increasing a specific proportion on average increases the respective cell population’s number of cells:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tmr_base</span> <span class="o">=</span> <span class="n">TreeMeanRelative</span><span class="p">(</span>
    <span class="n">flowsim_tree</span><span class="p">,</span>
    <span class="n">change_pop_mean_proportional</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">n_cells</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">tmr_ridiculously_changed</span> <span class="o">=</span> <span class="n">TreeMeanRelative</span><span class="p">(</span>
    <span class="n">flowsim_tree</span><span class="p">,</span>
    <span class="n">change_pop_mean_proportional</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">n_cells</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>You can check the changed parameters when sampling from the distribution:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_popcounts</span><span class="p">,</span> <span class="n">changed_parameters</span><span class="p">,</span> <span class="n">sampled_samples</span> <span class="o">=</span> <span class="n">tmr_base</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">r_true_popcounts</span><span class="p">,</span> <span class="n">r_changed_parameters</span><span class="p">,</span> <span class="n">r_sampled_samples</span> <span class="o">=</span> <span class="n">tmr_ridiculously_changed</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="n">changed_parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+       0.901580
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-       0.295210
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-           48.203633
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+       0.091623
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-            0.096534
                                                      ...
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+     0.159252
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-     0.153660
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-          0.125163
/AllCells/DN                                        15.218566
/AllCells/DP                                         1.755718
Name: 0, Length: 96, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_changed_parameters</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+        0.169073
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-        0.055361
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-             9.039610
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+        0.017182
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-             0.018103
                                                       ...
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+      0.029865
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-      0.028816
/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-           0.023472
/AllCells/DN                                        152.185662
/AllCells/DP                                          0.329249
Name: 0, Length: 96, dtype: float64
</pre></div></div>
</div>
<p>We observe that the concentration parameter of <code class="docutils literal notranslate"><span class="pre">/AllCells/DN</span></code> strongly increased! Therefore also the number of cells from that population changed</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_popcounts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample_0</th>
      <th>sample_1</th>
      <th>sample_2</th>
      <th>sample_3</th>
      <th>sample_4</th>
      <th>sample_5</th>
      <th>sample_6</th>
      <th>sample_7</th>
      <th>sample_8</th>
      <th>sample_9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-</th>
      <td>31.0</td>
      <td>29.0</td>
      <td>36.0</td>
      <td>31.0</td>
      <td>22.0</td>
      <td>30.0</td>
      <td>29.0</td>
      <td>24.0</td>
      <td>29.0</td>
      <td>31.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/DN</th>
      <td>6.0</td>
      <td>6.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>17.0</td>
      <td>9.0</td>
      <td>8.0</td>
      <td>13.0</td>
      <td>12.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>/AllCells/DP</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 10 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_true_popcounts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample_0</th>
      <th>sample_1</th>
      <th>sample_2</th>
      <th>sample_3</th>
      <th>sample_4</th>
      <th>sample_5</th>
      <th>sample_6</th>
      <th>sample_7</th>
      <th>sample_8</th>
      <th>sample_9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/DN</th>
      <td>86.0</td>
      <td>90.0</td>
      <td>90.0</td>
      <td>90.0</td>
      <td>83.0</td>
      <td>85.0</td>
      <td>82.0</td>
      <td>89.0</td>
      <td>85.0</td>
      <td>85.0</td>
    </tr>
    <tr>
      <th>/AllCells/DP</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 10 columns</p>
</div></div>
</div>
</section>
<section id="TreeMeanDistributionSampler">
<h3><code class="docutils literal notranslate"><span class="pre">TreeMeanDistributionSampler</span></code><a class="headerlink" href="#TreeMeanDistributionSampler" title="Permalink to this heading">¶</a></h3>
<div class="line-block">
<div class="line">The following sets up a <code class="docutils literal notranslate"><span class="pre">TreeMeanDistributionSampler</span></code> where the cell population <code class="docutils literal notranslate"><span class="pre">/AllCells/DN</span></code> is sampled from a normal distribution with mean of the original data and a standard deviation of 1 (default).</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">n_samples</span></code> is set to 2 and <code class="docutils literal notranslate"><span class="pre">n_cells</span></code> to 100.</div>
</div>
<p>Therefore, calling <code class="docutils literal notranslate"><span class="pre">tmr.sample()</span></code> generates two samples with the values from a normal distribution with a mean of 8.28% being in that population, a standard deviation of 1. The value from that normal distribution is then set as target for the Dirichlet distribution, and 100 cells are synthesized.</p>
<p><code class="docutils literal notranslate"><span class="pre">tmr.sample()</span></code> returns the number of cells per leaf population for both samples, the parameters after changing (the original tree is not changed) and the actually sampled samples.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbnode.simulation.TreeMeanDistributionSampler</span> <span class="kn">import</span> <span class="n">TreeMeanDistributionSampler</span>

<span class="n">tmds</span> <span class="o">=</span> <span class="n">TreeMeanDistributionSampler</span><span class="p">(</span>
    <span class="n">flowsim_tree</span><span class="p">,</span>
    <span class="n">population_name_to_change</span><span class="o">=</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_cells</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="p">(</span>
    <span class="n">all_true_popcounts</span><span class="p">,</span>
    <span class="n">all_changed_parameters</span><span class="p">,</span>
    <span class="n">all_sampled_samples</span><span class="p">,</span>
    <span class="n">all_targets</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">tmds</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>



<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_mean</span><span class="p">(</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">))</span>
<span class="n">all_true_popcounts</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.08279977774316377
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample_0</th>
      <th>sample_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-</th>
      <td>32.0</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/DN</th>
      <td>6.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>/AllCells/DP</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 2 columns</p>
</div></div>
</div>
<p>Alternatively, you can insert any population distribution with a function <code class="docutils literal notranslate"><span class="pre">mean_distribution</span></code> taking one argument (<code class="docutils literal notranslate"><span class="pre">original_mean</span></code>) and returning a class with a <code class="docutils literal notranslate"><span class="pre">.sample()</span></code> method which can be casted to <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p>Internally, the <code class="docutils literal notranslate"><span class="pre">target_mean_distribution</span></code> is set to <code class="docutils literal notranslate"><span class="pre">mean_distribution(original_mean)</span></code> of the original population. Then for every of the <code class="docutils literal notranslate"><span class="pre">n_samples</span></code>, a single value is sampled by <code class="docutils literal notranslate"><span class="pre">float(target_mean_distribution.sample())</span></code> and this value is set as mean of the Dirichlet distribution for the <code class="docutils literal notranslate"><span class="pre">population_name_to_change</span></code>.</p>
<p>We included a <code class="docutils literal notranslate"><span class="pre">PseudoTorchDistributionNormal</span></code> with the relevant method, but you can use any distribution from <a class="reference external" href="https://pytorch.org/docs/stable/distributions.html">pytorch-distributions</a>.</p>
<p>In the following example, we introduce a much higher variance on one population by basing it on a normal distribution with scale 10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nbnode.simulation.TreeMeanDistributionSampler</span> <span class="kn">import</span> <span class="n">PseudoTorchDistributionNormal</span>

<span class="n">tmds_custom</span> <span class="o">=</span> <span class="n">TreeMeanDistributionSampler</span><span class="p">(</span>
    <span class="n">flowsim_tree</span><span class="p">,</span>
    <span class="n">population_name_to_change</span><span class="o">=</span><span class="s2">&quot;/AllCells/DN&quot;</span><span class="p">,</span>
    <span class="n">mean_distribution</span><span class="o">=</span><span class="k">lambda</span> <span class="n">original_mean</span><span class="p">:</span> <span class="n">PseudoTorchDistributionNormal</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="n">original_mean</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">),</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">n_cells</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="p">(</span>
    <span class="n">all_true_popcounts</span><span class="p">,</span>
    <span class="n">all_changed_parameters</span><span class="p">,</span>
    <span class="n">all_sampled_samples</span><span class="p">,</span>
    <span class="n">all_targets</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">tmds_custom</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="n">all_true_popcounts</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
/home/gugl/.conda_envs/nbnode_pyscaffold/lib/python3.8/site-packages/nbnode/simulation/sim_target.py:90: UserWarning: Changing more than 1 population is NOT setting the means to the specifiedvalues - only the LAST value will be exactly the set percentage
  warnings.warn(
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample_0</th>
      <th>sample_1</th>
      <th>sample_2</th>
      <th>sample_3</th>
      <th>sample_4</th>
      <th>sample_5</th>
      <th>sample_6</th>
      <th>sample_7</th>
      <th>sample_8</th>
      <th>sample_9</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+</th>
      <td>23.0</td>
      <td>40.0</td>
      <td>50.0</td>
      <td>125.0</td>
      <td>23.0</td>
      <td>81.0</td>
      <td>32.0</td>
      <td>50.0</td>
      <td>29.0</td>
      <td>81.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23.0</td>
      <td>1.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-</th>
      <td>2671.0</td>
      <td>2698.0</td>
      <td>2865.0</td>
      <td>2693.0</td>
      <td>2262.0</td>
      <td>2362.0</td>
      <td>3006.0</td>
      <td>2262.0</td>
      <td>2621.0</td>
      <td>2837.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>32.0</td>
      <td>32.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-</th>
      <td>27.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>14.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1+</th>
      <td>0.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3.0</td>
      <td>14.0</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57+/PD1-</th>
      <td>0.0</td>
      <td>165.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>24.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/CD4-/CD8+/naive/CD27-/CD28-/CD57-</th>
      <td>44.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>/AllCells/DN</th>
      <td>529.0</td>
      <td>111.0</td>
      <td>2215.0</td>
      <td>1092.0</td>
      <td>524.0</td>
      <td>1056.0</td>
      <td>0.0</td>
      <td>1677.0</td>
      <td>954.0</td>
      <td>497.0</td>
    </tr>
    <tr>
      <th>/AllCells/DP</th>
      <td>96.0</td>
      <td>86.0</td>
      <td>28.0</td>
      <td>102.0</td>
      <td>3.0</td>
      <td>119.0</td>
      <td>59.0</td>
      <td>70.0</td>
      <td>242.0</td>
      <td>19.0</td>
    </tr>
  </tbody>
</table>
<p>96 rows × 10 columns</p>
</div></div>
</div>
</section>
</section>
<section id="FlowSimulationTree-methods-and-attributes">
<h2>FlowSimulationTree methods and attributes<a class="headerlink" href="#FlowSimulationTree-methods-and-attributes" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">FlowSimulationTree</span></code> has a number of interesting methods and attributes.</p>
<p><code class="docutils literal notranslate"><span class="pre">flowsim_tree.estimate_population_distribution()</span></code> Given node percentages per sample for all lefa nodes estimate their corresponding dirichlet parameters</p>
<p><code class="docutils literal notranslate"><span class="pre">flowsim_tree.remove_population()</span></code> You can remove a population from the Dirichlet distribution. No cells are going to be sampled from that one and the corresponding concentration parameter is removed (not redistributed).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span> <span class="s2">&quot;tests&quot;</span><span class="p">,</span> <span class="s2">&quot;testdata&quot;</span><span class="p">,</span> <span class="s2">&quot;flowcytometry&quot;</span><span class="p">,</span> <span class="s2">&quot;flowsim_tree.pickle&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">flowsim_tree</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Precision is equal to the total sum of concentration parameters</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">precision</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
183.79960241689196
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># concentration parameters for all populations, also intermediate populations</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">alpha_all</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1+      0.901580
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57+/PD1-      0.295210
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28+/CD57-          48.203633
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57+/PD1+      0.091623
/AllCells/CD4+/CD8-/Tcm/CD27+/CD28-/CD57-           0.096534
                                                     ...
/AllCells/CD4+/CD8-/Tem/CD27-/CD28+                 3.228699
/AllCells/CD4+/CD8-/Tem/CD27-/CD28-                 0.530434
/AllCells/CD4+/CD8-/Tem                            11.384744
/AllCells/CD4+/CD8-                               120.537038
/AllCells                                         183.799602
Name: 0, Length: 139, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># All leaf node names (i.e. populations) corresponding to the given population</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_leafnode_names</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">))</span>

<span class="c1"># Also works directly with NBNodes</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_leafnode_names</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">rootnode_structure</span><span class="p">[</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57+/PD1+&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57+/PD1-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57+/PD1+&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57+/PD1-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57+/PD1+&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57+/PD1-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57+/PD1+&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57+/PD1-&#39;, &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57-&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57+/PD1+&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57+/PD1-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28+/CD57-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57+/PD1+&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57+/PD1-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27+/CD28-/CD57-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57+/PD1+&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57+/PD1-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28+/CD57-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57+/PD1+&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57+/PD1-&#39;,
 &#39;/AllCells/CD4+/CD8-/naive/CD27-/CD28-/CD57-&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">rootnode_structure</span><span class="o">.</span><span class="n">pretty_print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AllCells (counter:0)
├── DN (counter:0)
├── DP (counter:0)
├── CD4-/CD8+ (counter:0)
│   ├── naive (counter:0)
│   │   ├── CD27+/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27+/CD28- (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27-/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   └── CD27-/CD28- (counter:0)
│   │       ├── CD57+/PD1+ (counter:0)
│   │       ├── CD57+/PD1- (counter:0)
│   │       └── CD57- (counter:0)
│   ├── Tcm (counter:0)
│   │   ├── CD27+/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27+/CD28- (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27-/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   └── CD27-/CD28- (counter:0)
│   │       ├── CD57+/PD1+ (counter:0)
│   │       ├── CD57+/PD1- (counter:0)
│   │       └── CD57- (counter:0)
│   ├── Temra (counter:0)
│   │   ├── CD27+/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27+/CD28- (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   ├── CD27-/CD28+ (counter:0)
│   │   │   ├── CD57+/PD1+ (counter:0)
│   │   │   ├── CD57+/PD1- (counter:0)
│   │   │   └── CD57- (counter:0)
│   │   └── CD27-/CD28- (counter:0)
│   │       ├── CD57+/PD1+ (counter:0)
│   │       ├── CD57+/PD1- (counter:0)
│   │       └── CD57- (counter:0)
│   └── Tem (counter:0)
│       ├── CD27+/CD28+ (counter:0)
│       │   ├── CD57+/PD1+ (counter:0)
│       │   ├── CD57+/PD1- (counter:0)
│       │   └── CD57- (counter:0)
│       ├── CD27+/CD28- (counter:0)
│       │   ├── CD57+/PD1+ (counter:0)
│       │   ├── CD57+/PD1- (counter:0)
│       │   └── CD57- (counter:0)
│       ├── CD27-/CD28+ (counter:0)
│       │   ├── CD57+/PD1+ (counter:0)
│       │   ├── CD57+/PD1- (counter:0)
│       │   └── CD57- (counter:0)
│       └── CD27-/CD28- (counter:0)
│           ├── CD57+/PD1+ (counter:0)
│           ├── CD57+/PD1- (counter:0)
│           └── CD57- (counter:0)
└── CD4+/CD8- (counter:0)
    ├── naive (counter:0)
    │   ├── CD27+/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27+/CD28- (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27-/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   └── CD27-/CD28- (counter:0)
    │       ├── CD57+/PD1+ (counter:0)
    │       ├── CD57+/PD1- (counter:0)
    │       └── CD57- (counter:0)
    ├── Tcm (counter:0)
    │   ├── CD27+/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27+/CD28- (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27-/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   └── CD27-/CD28- (counter:0)
    │       ├── CD57+/PD1+ (counter:0)
    │       ├── CD57+/PD1- (counter:0)
    │       └── CD57- (counter:0)
    ├── Temra (counter:0)
    │   ├── CD27+/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27+/CD28- (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   ├── CD27-/CD28+ (counter:0)
    │   │   ├── CD57+/PD1+ (counter:0)
    │   │   ├── CD57+/PD1- (counter:0)
    │   │   └── CD57- (counter:0)
    │   └── CD27-/CD28- (counter:0)
    │       ├── CD57+/PD1+ (counter:0)
    │       ├── CD57+/PD1- (counter:0)
    │       └── CD57- (counter:0)
    └── Tem (counter:0)
        ├── CD27+/CD28+ (counter:0)
        │   ├── CD57+/PD1+ (counter:0)
        │   ├── CD57+/PD1- (counter:0)
        │   └── CD57- (counter:0)
        ├── CD27+/CD28- (counter:0)
        │   ├── CD57+/PD1+ (counter:0)
        │   ├── CD57+/PD1- (counter:0)
        │   └── CD57- (counter:0)
        ├── CD27-/CD28+ (counter:0)
        │   ├── CD57+/PD1+ (counter:0)
        │   ├── CD57+/PD1- (counter:0)
        │   └── CD57- (counter:0)
        └── CD27-/CD28- (counter:0)
            ├── CD57+/PD1+ (counter:0)
            ├── CD57+/PD1- (counter:0)
            └── CD57- (counter:0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Concentration parameter for a single population</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_alpha</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
54.5458005721906
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mean for a single population</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_mean</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.2967677832537989
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the new mean of the Dirichlet distribution for a single population</span>
<span class="n">flowsim_tree</span><span class="o">.</span><span class="n">new_pop_mean</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_alpha</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_mean</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
91.89980120844596
0.5000000000000001
</pre></div></div>
</div>
<p>The previous command <code class="docutils literal notranslate"><span class="pre">new_pop_mean</span></code> actively changes the whole dirichlet distribution. It is usually important to reset the changed parameters to the original values. You can do this easily with <code class="docutils literal notranslate"><span class="pre">reset_populations</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">reset_populations</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_alpha</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flowsim_tree</span><span class="o">.</span><span class="n">pop_mean</span><span class="p">(</span><span class="s2">&quot;/AllCells/CD4+/CD8-/naive&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
54.5458005721906
0.2967677832537989
</pre></div></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">nbnode</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nbnode-01.html">Tutorial 1: NBNode basic,</a></li>
<li class="toctree-l2"><a class="reference internal" href="nbnode-02.html">Tutorial 2: Predictions I</a></li>
<li class="toctree-l2"><a class="reference internal" href="nbnode-03.html">Tutorial 3: Counting and math</a></li>
<li class="toctree-l2"><a class="reference internal" href="nbnode-04.html">Tutorial 4: Predictions II, data, plotting</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial 5: Cytometry simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">Module Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../notebooks.html">Tutorials</a><ul>
      <li>Previous: <a href="nbnode-04.html" title="previous chapter">Advanced predictions, data and plotting</a></li>
      <li>Next: <a href="../contributing.html" title="next chapter">Contributing</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, gunthergl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/notebooks/nbnode-05_sim.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>